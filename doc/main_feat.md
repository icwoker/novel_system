### ❓ 最后的 3 个关键疑问（请在研发会议上确认）

1.  [cite_start]**图片资源处理：** 文档中有 `cover_url` (封面) [cite: 62] [cite_start]和 `avatar` (头像) [cite: 74]。
    * *疑问：* V1.0 是仅支持用户**上传图片**，还是也直接接入 AI 绘图（DALL-E 3/Midjourney）？
    * *建议：* 既然主打 AI 写作，V1.0 先做**“用户上传”**，AI 绘图作为 P2 功能，避免研发初期工作量过大。
2.  **断网/离线保护：**
    * *疑问：* Web 端如果用户断网，正在写的几千字怎么办？
    * *建议：* 必须加 **Local Storage 本地缓存**。即使没网，刷新页面内容也不丢，等有网了再同步给后端。这个我们作为 P0 需求写入表里。
3.  **大纲的层级：**
    * *疑问：* 大纲是全书只有一个文本框，还是需要分卷大纲？
    * *建议：* 为了好卖，我们按照**“全局大纲 + 分卷大纲”**的双层结构来规划。

---

如果没有异议，以下是**《AI 网络小说创作 SaaS 平台 - 产品功能总表 (Master Feature List) v1.1》**。

这份表格是给研发团队看的**“最终需求范围”**，我们已经按 **P0 (MVP 核心)**、**P1 (V1.0 上线必备)**、**P2 (规划中)** 进行了严格分级。

### 📋 模块一：用户与权限 (User & Auth)
*研发注意：需新增 API Key 管理表和 Token 账单表。*

| ID | 功能点 | 优先级 | 需求描述 (User Story) | 研发技术点备注 |
| :--- | :--- | :--- | :--- | :--- |
| **U-01** | **注册/登录** | **P0** | [cite_start]邮箱+密码登录，JWT 鉴权。 | [cite: 84, 85] FastAPI OAuth2 |
| **U-02** | **个人中心** | **P0** | [cite_start]修改昵称、头像。 | [cite: 86] |
| **U-03** | **密码重置** | **P1** | 忘记密码流程（邮件验证码或旧密码修改）。 | 需集成邮件服务 (SMTP) |
| **U-04** | **AI 密钥管理** | **P0** | **(新增)** 用户可在设置页填写自己的 OpenAI/DeepSeek API Key。 | 需加密存储 (AES)，后端调用时优先取用 |
| **U-05** | **会员订阅** | **P1** | **(新增)** 展示用户等级（Free/Pro），限制 AI 使用额度。 | DB需增加 `subscription_tier` |

### 📋 模块二：小说管理 (Novel Management)
*研发注意：数据结构需扩展，支持大纲和更多元信息。*

| ID | 功能点 | 优先级 | 需求描述 (User Story) | 研发技术点备注 |
| :--- | :--- | :--- | :--- | :--- |
| **N-01** | **书架列表** | **P0** | [cite_start]展示封面、书名、字数、状态。 | [cite: 88] |
| **N-02** | **创建/编辑书籍** | **P0** | [cite_start]输入书名、简介、封面。 | [cite: 89] |
| **N-03** | **目录树管理** | **P0** | [cite_start]卷/章嵌套结构，支持拖拽排序。 | [cite: 90, 121] React DnD/dnd-kit |
| **N-04** | **回收站** | **P1** | **(新增)** 软删除书籍或章节，可恢复（防手滑）。 | DB 增加 `is_deleted` 字段 |
| **N-05** | **导出功能** | **P1** | **(新增)** 将整书或单卷导出为 TXT/Word 格式。 | 后端需生成文件流 |

### 📋 模块三：核心编辑器 (Writer Core)
*研发注意：这是体验核心，前端重难点，需支持离线缓存。*

| ID | 功能点 | 优先级 | 需求描述 (User Story) | 研发技术点备注 |
| :--- | :--- | :--- | :--- | :--- |
| **E-01** | **富文本编辑** | **P0** | [cite_start]Tiptap 基础功能 (H1-H3, Bold, Italic)。 | [cite: 13, 128] |
| **E-02** | **自动保存** | **P0** | [cite_start]停止输入 2秒 后自动提交 PUT 请求。 | [cite: 130] Debounce |
| **E-03** | **断网保护** | **P0** | **(新增)** 内容实时写入 LocalStorage，断网不丢稿。 | 前端逻辑 |
| **E-04** | **实时字数** | **P0** | [cite_start]实时显示当前章节字数。 | [cite: 68] |
| **E-05** | **AI 浮动菜单** | **P0** | [cite_start]选中文本弹出 Bubble Menu，点击触发 AI。 | [cite: 129] |
| **E-06** | **全屏禅模式** | **P1** | **(新增)** 一键隐藏 UI，沉浸式写作。 | 前端 CSS 状态切换 |
| **E-07** | **夜间模式** | **P1** | **(新增)** 编辑器配色切换（亮/暗/羊皮纸）。 | Tailwind Dark Mode |
| **E-08** | **章末总结** | **P0** | [cite_start]当一章完结后，形成的主要内容总结。 | [cite: 68] |

### 📋 模块四：世界观与辅助 (World Bible)
*研发注意：需扩充 DB Schema，增加 Location 和 Item 表。*

| ID | 功能点 | 优先级 | 需求描述 (User Story) | 研发技术点备注 |
| :--- | :--- | :--- | :--- | :--- |
| **W-01** | **人物管理** | **P0** | [cite_start]增删改查人物（姓名、立绘、设定，tag字段）。 | [cite: 71] |
| **W-02** | **人物关系图** | **P1** | [cite_start]可视化编辑人物连接（React Flow）。 | [cite: 79, 131] |
| **W-03** | **地点/物品库** | **P1** | **(新增)** 管理地图地点、武器道具设定。 | 新增 DB Tables |
| **W-04** | **分卷大纲** | **P1** | **(新增)** 独立的大纲编辑界面，非正文。 | 需设计 Outline 数据结构 |
| **W-05** | **侧边参考栏** | **P2** | **(新增)** 写作时右侧固定显示人物/大纲资料。 | 前端 Layout 调整 |


### 📋 模块五：AI 服务中台 (AI Copilot Services)
*研发注意：核心是 Token 计费逻辑和多渠道 API 路由。*

| ID | 功能点 | 优先级 | 需求描述 (User Story) | 研发技术点备注 |
| :--- | :--- | :--- | :--- | :--- |
| **A-01** | **AI 润色/续写** | **P0** | [cite_start]基础流式接口 (SSE)。 | [cite: 99] OpenAI SDK |
| **A-02** | **上下文组装** | **P0** | [cite_start]自动提取当前选中人物的 Bio 放入 Prompt。 | [cite: 103] Prompt Engineering |
| **A-03** | **渠道路由** | **P0** | **(新增)** 判断用户是否有 Key。有->用用户的; 无->用平台的。 | 后端逻辑判断 |
| **A-04** | **Token 监控** | **P1** | **(新增)** 记录每次 AI 请求消耗，扣除平台额度。 | Middleware 拦截记录 |
| **A-05** | **起名助手** | **P1** | **(新增)** 随机生成人名/地名/功法名。 | 预设 Prompt 模板 |
| **A-06** | **剧情生成** | **P1** | **(新增)** 根据前文生成 3 个后续分支建议。 | 长文本 Context 处理 |

### 📋 模块六：移动端规划 (Mobile - Future)
*研发注意：后端 API 必须遵循 RESTful 标准，为未来 RN 做准备。*

| ID | 功能点 | 优先级 | 需求描述 (User Story) | 研发技术点备注 |
| :--- | :--- | :--- | :--- | :--- |
| **M-01** | **API 兼容性** | **P0** | [cite_start]所有接口返回 JSON，无服务端渲染 HTML。 | [cite: 33, 38] 已经是标准 |
| **M-02** | **H5 适配** | **P1** | **(新增)** 手机浏览器访问时，至少能查看和简单编辑。 | 响应式布局 |
| **M-03** | **React Native** | **P2** | 独立 App 开发。 | 远期规划 |

---

### 给研发负责人的交接话术 (PM视角的 Next Step)

> “老兄，这是定稿的功能表。重点关注 **U-04 (AI Key)** 和 **A-03 (渠道路由)**，这块逻辑要写死在后端里。另外数据库除了文档里的 `users` 和 `novels`，你需要把 `locations`、`items` 和 `subscriptions` 的表结构补上。所有的功能范围就锁定在 **P0 和 P1**，P2 的东西我们下个版本再说，绝不临时加塞。”
